<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4 EM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* --- Layout & Responsiveness --- */
        body { 
            background-color: #fff0f5; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 10px; /* Reduced for more screen space */
            box-sizing: border-box;
            font-family: 'Dancing Script', cursive; 
            overflow: hidden; /* Prevent scrolling during the moment */
        }

        .scroll-container { 
            position: relative; 
            width: 100%; 
            max-width: 550px; 
            height: 92vh; /* Increased to fit all content */
            max-height: 850px;
        } 

        /* --- Wooden Handles --- */
        .handle { 
            position: absolute; 
            left: -2%; 
            width: 104%; 
            height: 25px; 
            background: linear-gradient(to bottom, #5d3a1a, #8f5e2e 40%, #5d3a1a 100%); 
            border-left: 4px solid #3e250f; 
            border-right: 4px solid #3e250f; 
            box-sizing: border-box; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.5); 
            z-index: 10; 
        } 

        .handle-top { top: 0; border-radius: 8px 8px 0 0; }
        .handle-bottom-roller { 
            top: 25px; 
            border-radius: 0 0 8px 8px; 
            animation: rollDown 3.5s ease-in-out forwards; 
            box-shadow: 0 -5px 15px rgba(0,0,0,0.6), 0 2px 5px rgba(0,0,0,0.5); 
        } 

        /* --- Paper Area --- */
        .scroll-paper { 
            position: absolute; 
            top: 25px; 
            left: 0; 
            width: 100%; 
            height: 0; 
            background-color: #f4e4bc; 
            background-image: url('https://www.transparenttextures.com/patterns/parchment.png'), 
                              linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0) 10%, rgba(0,0,0,0) 90%, rgba(0,0,0,0.1)); 
            overflow: hidden; 
            box-shadow: inset 0 0 30px rgba(93, 58, 26, 0.3); 
            z-index: 5; 
            animation: revealPaperVertical 3.5s ease-in-out forwards; 
        } 

        .scroll-content { 
            padding: 25px 20px; /* Tighter padding to fit everything */
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            justify-content: flex-start; 
            align-items: center; 
            text-align: center; 
            box-sizing: border-box;
            color: #2a241d; 
        } 

        h2 { font-size: 1.8rem; margin: 0 0 5px 0; border-bottom: 2px double #2a241d33; }
        #decree-text { 
            font-size: 1.1rem; 
            line-height: 1.25; 
            margin: 8px 0; 
            white-space: pre-wrap; 
            word-wrap: break-word; 
        }

        @media (min-width: 600px) {
            h2 { font-size: 2.5rem; }
            #decree-text { font-size: 1.3rem; }
        }

        /* --- Interaction Area --- */
        .quest-section { 
            margin-top: 5px; 
            padding: 8px; 
            border: 1px dashed rgba(43, 36, 28, 0.2); 
            opacity: 0; 
            transition: opacity 1s ease-in-out; 
            width: 95%;
        } 

        .options { display: flex; justify-content: space-around; width: 100%; margin-top: 5px; } 
        input[type="checkbox"] { display: none; }
        label { cursor: pointer; display: flex; align-items: center; font-size: 1.4rem; font-weight: 600; padding: 5px; } 

        label::before { 
            content: ''; display: inline-block; width: 22px; height: 22px; margin-right: 6px; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3E%3Cpath fill='none' stroke='%232a241d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' d='M4.5,4.5 c5,0.5, 15,-1, 21,2 c0.5,5, -1,15, 2,21 c-5,0.5, -15,-1, -21,2 c-0.5,-5, 1,-15, -2,-21 Z' /%3E%3C/svg%3E"); 
            background-size: contain; 
        } 

        input[type="checkbox"]:checked + label::before { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3E%3Cg fill='none' stroke='%232a241d' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M4.5,4.5 c5,0.5, 15,-1, 21,2 c0.5,5, -1,15, 2,21 c-5,0.5, -15,-1, -21,2 c-0.5,-5, 1,-15, -2,-21 Z' stroke-width='2'/%3E%3Cpath d='M7,15 c2,5, 5,10, 7,12 c5,-10, 10,-15, 12,-20' /%3E%3C/g%3E%3C/svg%3E"); 
        } 

        .nay-text::after { content: 'Nay'; } 
        label[for="choice-no"]:hover .nay-text::after,
        #choice-no:checked + label .nay-text::after { content: 'Aye'; color: #800000; } 

        /* --- Signature & Seal --- */
        .signature { 
            font-size: 1.8rem; 
            color: #1a1a1a; 
            margin-top: 10px; 
            width: 200px; 
            white-space: nowrap; 
            overflow: hidden; 
            border-bottom: 1px solid rgba(0,0,0,0.15); 
            clip-path: inset(0 100% 0 0); 
        } 
        
        .wax-seal { 
            width: 65px; height: 65px; 
            background: radial-gradient(circle at 30% 30%, #a52a2a, #800000); 
            border-radius: 50%; 
            margin-top: 5px; 
            display: flex; justify-content: center; align-items: center; 
            color: #d4af37; font-size: 1.8rem; 
            transform: rotate(-5deg) scale(0); 
            border: 2px solid #600; 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
        } 
        
        /* --- Animations --- */
        @keyframes rollDown { from { top: 25px; } to { top: calc(100% - 25px); } }
        @keyframes revealPaperVertical { from { height: 0; } to { height: calc(100% - 25px); } }
        @keyframes rollUp { from { top: calc(100% - 25px); } to { top: 25px; } }
        @keyframes concealPaperVertical { from { height: calc(100% - 25px); } to { height: 0; } }
        @keyframes writeSignature { to { clip-path: inset(0 0 0 0); } }
        @keyframes stampSeal { to { transform: rotate(-5deg) scale(1); } }

        .scroll-container.closed .handle-bottom-roller { animation: rollUp 2.5s ease-in-out forwards; }
        .scroll-container.closed .scroll-paper { animation: concealPaperVertical 2.5s ease-in-out forwards; }
    </style>
</head>
<body>

    <div class="scroll-container">
        <div class="handle handle-top"></div>
        <div class="scroll-paper">
            <div class="scroll-content">
                <h2 id="title"></h2>
                <p id="decree-text"></p>
                <div class="quest-section" id="quest-section">
                    <p><strong id="question-text"></strong></p>
                    <div class="options">
                        <input type="checkbox" id="choice-yes" class="exclusive-checkbox">
                        <label for="choice-yes">Aye</label>
                        <input type="checkbox" id="choice-no" class="exclusive-checkbox">
                        <label for="choice-no"><span class="nay-text"></span></label>
                    </div>
                </div>
                <div class="signature" id="signature">Yours always</div>
                <div class="wax-seal" id="wax-seal"><span>D</span></div>
            </div>
        </div>
        <div class="handle handle-bottom-roller"></div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwBL4W44F5h8iRrcf80VIUcvm-T2AdxjdaHfSLstqeNs38ORbDO0YxrUPnGcqIeCfx9/exec";

        function triggerGoogleInvite() {
            fetch(GOOGLE_SCRIPT_URL, { method: "POST", mode: "no-cors" }).catch(err => console.log(err));
        }

        // UPGRADED: High-Intensity Confetti
        function triggerHearts() {
            const end = Date.now() + (4 * 1000); // 4 seconds of continuous firing
            const colors = ['#ff0000', '#ff69b4', '#ff1493'];

            (function frame() {
              confetti({
                particleCount: 4,
                angle: 60,
                spread: 55,
                origin: { x: 0, y: 0.7 },
                colors: colors,
                shapes: ['heart']
              });
              confetti({
                particleCount: 4,
                angle: 120,
                spread: 55,
                origin: { x: 1, y: 0.7 },
                colors: colors,
                shapes: ['heart']
              });

              if (Date.now() < end) {
                requestAnimationFrame(frame);
              }
            }());
        }

        const checkboxes = document.querySelectorAll('.exclusive-checkbox');
        const scrollContainer = document.querySelector('.scroll-container');

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    checkboxes.forEach(box => {
                        box.disabled = true;
                        if (box !== this) box.checked = false;
                    });
                    
                    triggerHearts(); // Start the 4-second intense heart shower
                    triggerGoogleInvite(); 
                    
                    // Close the scroll after 5 seconds so they can see all the hearts
                    setTimeout(() => {
                        scrollContainer.classList.add('closed');
                    }, 5000);
                }
            });
        });

        function typeWriter(elementId, text, speed, callback) {
            const element = document.getElementById(elementId);
            let i = 0;
            function typing() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(typing, speed);
                } else if (callback) { callback(); }
            }
            typing();
        }

        setTimeout(() => {
            typeWriter('title', 'For the finest lady in the land..', 100, () => {
                typeWriter('decree-text', `My dearest Emily, 

my love,
my bestfriend,
my violet in the sun,
thank you for loving me the way you do,
on this day celebrating love,
and every day that follows,
let it be known that I choose you....`, 30, () => {
                    document.getElementById('quest-section').style.opacity = 1;
                    typeWriter('question-text', 'Will you be my Valentine?', 40, () => {
                        document.getElementById('signature').style.animation = 'writeSignature 2s steps(40) forwards';
                        setTimeout(() => {
                            document.getElementById('wax-seal').style.animation = 'stampSeal 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards';
                        }, 1500);
                    });
                });
            });
        }, 800);
    </script>
</body>
</html>
